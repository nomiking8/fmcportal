{% extends "base.html" %}
{% block title %}Edit FMC Data{% endblock %}
{% block content %}
    <h1>Edit FMC Data</h1>
    <form method="POST" action="{{ url_for('edit', id=fmc.id) }}">
        <div class="form-section">
            <h2>General Information</h2>
            <div class="form-group">
                <label for="region">Region</label>
                <input type="text" id="region" name="region" value="{{ fmc.region }}" readonly>
            </div>
            <div class="form-group">
                <label for="category">Category</label>
                <select id="category" name="category" required>
                    {% for cat in user_categories %}
                        <option value="{{ cat }}" {% if cat == fmc.category %}selected{% endif %}>{{ cat }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="domain">Domain</label>
                <select id="domain" name="domain" required>
                    <!-- Populated dynamically via JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="cable_cut_noc_id">Cable Cut NOC ID</label>
                <input type="text" id="cable_cut_noc_id" name="cable_cut_noc_id" value="{{ fmc.cable_cut_noc_id or '' }}">
            </div>
            <div class="form-group">
                <label for="cable_used_meters">Cable Used (Meters)</label>
                <input type="number" step="0.01" id="cable_used_meters" name="cable_used_meters" value="{{ fmc.cable_used_meters or '' }}">
            </div>
            <div class="form-group">
                <label for="cable_type">Cable Type</label>
                <select id="cable_type" name="cable_type">
                    <option value="">Select Cable Type</option>
                    <option value="UG" {% if fmc.cable_type == 'UG' %}selected{% endif %}>UG</option>
                    <option value="Aerial" {% if fmc.cable_type == 'Aerial' %}selected{% endif %}>Aerial</option>
                </select>
            </div>
            <div class="form-group">
                <label for="cable_capacity">Cable Capacity</label>
                <input type="text" id="cable_capacity" name="cable_capacity" value="{{ fmc.cable_capacity or '' }}">
            </div>
            <div class="form-group">
                <label for="no_of_joints">No. of Joints Used</label>
                <input type="number" id="no_of_joints" name="no_of_joints" value="{{ fmc.no_of_joints or '' }}">
            </div>
        </div>
        <div class="form-section">
            <h2>Joint Types</h2>
            <div id="joint-types-container">
                {% for jt in joint_types %}
                    <input type="text" name="joint_type[]" value="{{ jt }}">
                {% endfor %}
            </div>
        </div>
        <div class="form-section">
            <h2>Pipe Information</h2>
            <div class="form-group">
                <label for="pipe_used_meters">Pipe Used (Meters)</label>
                <input type="number" step="0.01" id="pipe_used_meters" name="pipe_used_meters" value="{{ pipe_info.pipe_used_meters or '' }}">
            </div>
            <div class="form-group">
                <label for="pipe_size_inches">Pipe Size (Inches)</label>
                <input type="number" step="0.01" id="pipe_size_inches" name="pipe_size_inches" value="{{ pipe_info.pipe_size_inches or '' }}">
            </div>
            <div class="form-group">
                <label for="pipe_type">Pipe Type</label>
                <input type="text" id="pipe_type" name="pipe_type" value="{{ pipe_info.pipe_type or '' }}">
            </div>
        </div>
        <button type="submit">Update</button>
    </form>
{% endblock %}
{% block scripts %}
    <script>
        const validDomains = {
            'Longhaul': [
                'FMC Taxila', 'FMC Fateh Jang', 'FMC Rawalpindi', 'FMC Murree',
                'FMC Gujar Khan', 'FMC Chakwal', 'FMC Talagang', 'FMC Jhelum', 'FMC PD Khan'
            ],
            'GPON_FMC': [
                'FMC Attock GPON', 'FMC Wah GPON', 'FMC Taxila GPON', 'FMC Murree GPON',
                'FMC Gujar Khan GPON', 'FMC Chakwal GPON', 'FMC Jhelum GPON'
            ]
        };

        function updateDomainOptions() {
            const category = document.getElementById('category').value;
            const domainSelect = document.getElementById('domain');
            domainSelect.innerHTML = '<option value="">Select Domain</option>';
            if (category && validDomains[category]) {
                validDomains[category].forEach(function(domain) {
                    const option = document.createElement('option');
                    option.value = domain;
                    option.textContent = domain;
                    if (domain === '{{ fmc.domain }}') {
                        option.selected = true;
                    }
                    domainSelect.appendChild(option);
                });
            }
        }

        document.getElementById('category').addEventListener('change', updateDomainOptions);
        document.getElementById('no_of_joints').addEventListener('input', function() {
            const noOfJoints = parseInt(this.value) || 0;
            const container = document.getElementById('joint-types-container');
            container.innerHTML = '';
            for (let i = 0; i < noOfJoints; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.name = 'joint_type[]';
                input.placeholder = `Joint Type ${i + 1}`;
                container.appendChild(input);
            }
        });

        // Initialize domain options on page load
        updateDomainOptions();
    </script>
{% endblock %}