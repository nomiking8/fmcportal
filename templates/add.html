{% extends "base.html" %}
{% block title %}Add FMC Data{% endblock %}
{% block content %}
    <h1>Add FMC Data</h1>
    <form method="POST" action="{{ url_for('add') }}">
        <div class="form-section">
            <h2>General Information</h2>
            <div class="form-group">
                <label for="region">Region</label>
                <input type="text" id="region" name="region" value="RTR" readonly>
            </div>
            <div class="form-group">
                <label for="category">Category</label>
                {% if user_role == 'master' %}
                    <select id="category" name="category" required>
                        {% for cat in ['Longhaul', 'GPON_FMC'] %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                {% else %}
                    <select id="category" name="category" required>
                        {% for cat in user_categories %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                {% endif %}
            </div>
            <div class="form-group">
                <label for="domain">Domain</label>
                {% if user_role == 'master' %}
                    <select id="domain" name="domain" required>
                        <!-- Populated dynamically via JavaScript -->
                    </select>
                {% else %}
                    <select id="domain" name="domain" required>
                        {% for dom in user_domains %}
                            <option value="{{ dom }}">{{ dom }}</option>
                        {% endfor %}
                    </select>
                {% endif %}
            </div>
            <div class="form-group">
                <label for="cable_cut_noc_id">Cable Cut NOC ID</label>
                <input type="text" id="cable_cut_noc_id" name="cable_cut_noc_id">
            </div>
            <div class="form-group">
                <label for="cable_used_meters">Cable Used (Meters)</label>
                <input type="number" step="0.01" id="cable_used_meters" name="cable_used_meters">
            </div>
            <div class="form-group">
                <label for="cable_type">Cable Type</label>
                <select id="cable_type" name="cable_type">
                    <option value="">Select Cable Type</option>
                    <option value="UG">UG</option>
                    <option value="Aerial">Aerial</option>
                </select>
            </div>
            <div class="form-group">
                <label for="cable_capacity">Cable Capacity</label>
                <input type="text" id="cable_capacity" name="cable_capacity">
            </div>
            <div class="form-group">
                <label for="no_of_joints">No. of Joints Used</label>
                <input type="number" id="no_of_joints" name="no_of_joints">
            </div>
        </div>
        <div class="form-section">
            <h2>Joint Types</h2>
            <div id="joint-types-container"></div>
        </div>
        <div class="form-section">
            <h2>Pipe Information</h2>
            <div class="form-group">
                <label for="pipe_used_meters">Pipe Used (Meters)</label>
                <input type="number" step="0.01" id="pipe_used_meters" name="pipe_used_meters">
            </div>
            <div class="form-group">
                <label for="pipe_size_inches">Pipe Size (Inches)</label>
                <input type="number" step="0.01" id="pipe_size_inches" name="pipe_size_inches">
            </div>
            <div class="form-group">
                <label for="pipe_type">Pipe Type</label>
                <input type="text" id="pipe_type" name="pipe_type">
            </div>
        </div>
        <button type="submit">Submit</button>
    </form>
{% endblock %}
{% block scripts %}
    <script>
        const validDomains = {
            'Longhaul': [
                'FMC Taxila', 'FMC Fateh Jang', 'FMC Rawalpindi', 'FMC Murree',
                'FMC Gujar Khan', 'FMC Chakwal', 'FMC Talagang', 'FMC Jhelum', 'FMC PD Khan'
            ],
            'GPON_FMC': [
                'FMC Attock GPON', 'FMC Wah GPON', 'FMC Taxila GPON', 'FMC Murree GPON',
                'FMC Gujar Khan GPON', 'FMC Chakwal GPON', 'FMC Jhelum GPON'
            ]
        };

        document.getElementById('category').addEventListener('change', function() {
            const category = this.value;
            const domainSelect = document.getElementById('domain');
            domainSelect.innerHTML = '<option value="">Select Domain</option>';
            if (category && validDomains[category]) {
                validDomains[category].forEach(function(domain) {
                    const option = document.createElement('option');
                    option.value = domain;
                    option.textContent = domain;
                    domainSelect.appendChild(option);
                });
            }
        });

        document.getElementById('no_of_joints').addEventListener('input', function() {
            const noOfJoints = parseInt(this.value) || 0;
            const container = document.getElementById('joint-types-container');
            container.innerHTML = '';
            for (let i = 0; i < noOfJoints; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.name = 'joint_type[]';
                input.placeholder = `Joint Type ${i + 1}`;
                container.appendChild(input);
            }
        });
    </script>
{% endblock %}